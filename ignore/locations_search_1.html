<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Christopher Marks" />

<meta name="date" content="2019-01-18" />

<title>Locations Search Part I</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">Locations Search Part I</h1>
<h4 class="author"><em>Christopher Marks</em></h4>
<h4 class="date"><em>2019-01-18</em></h4>



<div id="part-i-initialize-and-execute-search-queries" class="section level1">
<h1>PART I: Initialize and Execute Search Queries</h1>
<p>This is the first part of a two-part vignette demonstrate the use of the Twitter Search API collection and analysis functionality of the <code>twinfoR</code> package. One use of Twitter analyses is to investigate what is going on in different locations. A simple way to collect Tweets related to a location is to use the <a href="https://developer.twitter.com/en/docs/tweets/search/api-reference/get-search-tweets">Twitter Search API</a>, searching on the hashtag containing the location name. Of course, this introduces a bias into the analysis, but can still be useful.</p>
<p>In this Vignette, we’ll look at two locations: Boston and Guatemala City. We’ll use the following hashtags:</p>
<ol style="list-style-type: decimal">
<li>Boston ** #Boston</li>
<li>Guatemala City ** #GuatemalaCity ** #CiudaddeGuatemala ** #CuidadGuatemala</li>
</ol>
</div>
<div id="package-import" class="section level1">
<h1>Package Import</h1>
<p>Let’s start by importing the <code>twinfoR</code> namespace. Don’t forget to install the package, if you haven’t already.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="co"># install.packages(&quot;twinfoR.zip&quot;,repos=NULL,type=&quot;binary&quot;)</span></a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(twinfoR)</a></code></pre></div>
</div>
<div id="some-important-initializations" class="section level1">
<h1>Some important initializations</h1>
<div id="query-text-table" class="section level2">
<h2>Query Text Table</h2>
<p>We’ll be using the <code>query_text</code> table functionality of the <code>twitter_database</code>. See <code>twitter_database</code> documentation for details. We begin by creating the <code>query_text</code> table containing our search queries.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1">query.text.dataframe &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb2-2" title="2">  <span class="dt">query_text =</span> <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb2-3" title="3">    <span class="st">&quot;#Boston&quot;</span>,</a>
<a class="sourceLine" id="cb2-4" title="4">    <span class="st">&quot;#GuatemalaCity&quot;</span>,</a>
<a class="sourceLine" id="cb2-5" title="5">    <span class="st">&quot;#CiudaddeGuatemala&quot;</span>,</a>
<a class="sourceLine" id="cb2-6" title="6">    <span class="st">&quot;#CiudadGuatemala&quot;</span></a>
<a class="sourceLine" id="cb2-7" title="7">  ),</a>
<a class="sourceLine" id="cb2-8" title="8">  <span class="dt">location =</span> <span class="kw">c</span>(</a>
<a class="sourceLine" id="cb2-9" title="9">    <span class="st">&quot;Boston&quot;</span>,</a>
<a class="sourceLine" id="cb2-10" title="10">    <span class="st">&quot;Guatemala City&quot;</span>,</a>
<a class="sourceLine" id="cb2-11" title="11">    <span class="st">&quot;Guatemala City&quot;</span>,</a>
<a class="sourceLine" id="cb2-12" title="12">    <span class="st">&quot;Guatemala City&quot;</span></a>
<a class="sourceLine" id="cb2-13" title="13">  ),</a>
<a class="sourceLine" id="cb2-14" title="14">  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb2-15" title="15">)</a></code></pre></div>
</div>
<div id="initialize-database" class="section level2">
<h2>Initialize database</h2>
<p>We need to set a working directory to store the database and analysis products. Once we set the directory, we’ll change into it and initialize the location database with our <code>query.text.dataframe</code>. Note that this vignette does not use the <code>query_users</code> table, but it could. See the US Politics vignette and the <code>twitter_database</code> documentation for examples on how to include and use a <code>query_users</code> table.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">dir.create</span>(<span class="st">&quot;~/twitter_locations&quot;</span>,<span class="dt">showWarnings=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">setwd</span>(<span class="st">&quot;~/twitter_locations&quot;</span>)</a>
<a class="sourceLine" id="cb3-3" title="3">con &lt;-<span class="st"> </span><span class="kw">twitter_database</span>(</a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="st">&quot;locations.sqlite&quot;</span>,</a>
<a class="sourceLine" id="cb3-5" title="5">  <span class="dt">query.text.df =</span> query.text.dataframe</a>
<a class="sourceLine" id="cb3-6" title="6">)</a></code></pre></div>
</div>
<div id="authenticate-to-twitter-api" class="section level2">
<h2>Authenticate to Twitter API</h2>
<p>We’ll use the <a href="http://zlisto.scripts.mit.edu/informs_tutorial/tutorial.html">INFORM-Tutorial</a> Twitter Application. Alternatively, you can supply your own application credentials using the <code>authorize_app</code> function.</p>
<p><em>You will need a Twitter Account to continue!</em> If you don’t have one, you can easily create one on the <a href="https://twitter.com">Twitter</a> website. If you do not have a Twitter account and do not wish to make one, <em>this package will be of very limited use to you</em>.</p>
<p>I recommend logging onto Twitter in your Browser before running this line. Either way, be careful not to hit <Enter> immediately after running it, for example by copying and pasting the whole line with the ‘newline’ character into an R console.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">auth.vector &lt;-<span class="st"> </span><span class="kw">authorize_IT</span>()</a></code></pre></div>
<p>Run this line, log into Twitter, and get the authentication PIN. If you get an error message from Twitter saying the URL is expired, the probable cause is that you hit <Enter> before entering the PIN, possibly when you copied and pasted the command.</p>
<p>It is important to name the result <code>auth.vector</code> as shown above, as the functions in the <code>twinfoR</code> package look for this global variable. If you give this result a different name, you must manually supply it to the Twitter API methods. Optionally, save this vector in order to skip the authentication process in the future.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">save</span>(auth.vector,<span class="dt">file=</span><span class="st">&quot;auth_vector.RData&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="search" class="section level1">
<h1>Search</h1>
<p>Now we query the Twitter Search API for the search queries in the <code>query_text</code> table. We will <em>not</em> include sentiment analysis. For examples on how to include sentiment analysis in Twitter collections, see the documentation for <code>insert_statuses</code>, <code>user_timeline_recursive</code>,<code>update_user_timelines</code>, and <code>update_search</code>, as well as the US Politics vignette.</p>
<p>Because of the Twitter API rate limits, this could take a few minutes.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="kw">update_search</span>(</a>
<a class="sourceLine" id="cb6-2" title="2">  con,</a>
<a class="sourceLine" id="cb6-3" title="3">  <span class="dt">calc.Rsentiment =</span> <span class="ot">FALSE</span>, <span class="co">#Not required; this is the default</span></a>
<a class="sourceLine" id="cb6-4" title="4">  <span class="dt">calc.syu =</span> <span class="ot">FALSE</span> <span class="co">#Not required; this is the default</span></a>
<a class="sourceLine" id="cb6-5" title="5">)</a></code></pre></div>
</div>
<div id="summarize-the-database" class="section level1">
<h1>Summarize the database</h1>
<p>To wrap up part I, we can view a summary of what is in our Twitter database.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">summarize_database</span>(con)</a>
<a class="sourceLine" id="cb7-2" title="2"><span class="co">#&gt; No query user table.</span></a>
<a class="sourceLine" id="cb7-3" title="3"><span class="co">#&gt; Search queries: 4</span></a>
<a class="sourceLine" id="cb7-4" title="4"><span class="co">#&gt; Search categories:</span></a>
<a class="sourceLine" id="cb7-5" title="5"><span class="co">#&gt; location</span></a>
<a class="sourceLine" id="cb7-6" title="6"><span class="co">#&gt; since_id</span></a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co">#&gt; Users: 11351</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">#&gt; Statuses: 21618</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">#&gt; Unique user mentions: 5582</span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="co">#&gt; Unique hashtags: 15931</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="co">#&gt; Unique URLs: 7208</span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="co">#&gt; Total Images: 6311</span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co">#&gt; Unique Images: 5407</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="co">#&gt; Total relationships: 0</span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="co">#&gt; Cannot get file size.  Did you change directory?</span></a></code></pre></div>
<p>Finally, to conclude this part of the vignette, we close the data connection.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">DBI<span class="op">::</span><span class="kw">dbDisconnect</span>(con)</a></code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
