<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Christopher Marks" />

<meta name="date" content="2019-01-18" />

<title>US Politics Part I</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' || rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>



<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#header {
text-align: center;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; }  code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>

</head>

<body>




<h1 class="title toc-ignore">US Politics Part I</h1>
<h4 class="author"><em>Christopher Marks</em></h4>
<h4 class="date"><em>2019-01-18</em></h4>



<div id="part-i-initialize-and-collect-user-timelines-friends" class="section level1">
<h1>PART I: Initialize and Collect User Timelines &amp; Friends</h1>
<p>This is the first part of a two-part vignette designed to collect and analyze Twitter posts from members of the US Congress and the US President. This part of the vignette carries out the database initialization and initial status collections.</p>
<p><strong>Very Important Note:</strong> This vignette is set up to collect the relationships and timelines of over 500 politicians. Because people in this profession tend to be prolific Tweeters, the initial calls to the collection functions can take a <em>very</em> long time to complete. In particular, collecting all of the 500+ users’ friends will take approximately <strong>15-20 hours</strong>. Collection of all of the users’ timelines, and performing sentiment analysis on them, will likely take <strong>several days</strong>.</p>
<p>For an abbreviated version of this vignette, you can perform the same collection and analysis on a small sample of the politicians. Code to perform this sampling is included in this vignette, but is commented out.</p>
<p>The second part of this vignette performs updates the database and analyzes the results.</p>
<div id="set-java-options" class="section level2">
<h2>Set Java Options</h2>
<p>The sentiment analysis we conduct during Twitter collection tends to require more Java heap space than the default. Therefore, we start by allocating more space.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">options</span>(<span class="dt">java.parameters =</span> <span class="st">&quot;-Xmx1024m&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="package-import" class="section level1">
<h1>Package Import</h1>
<p>Let’s start by importing the <code>twinfoR</code> namespace. Don’t forget to install the package, if you haven’t already.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="co"># install.packages(&quot;twinfoR.zip&quot;,repos=NULL,type=&quot;binary&quot;)</span></a>
<a class="sourceLine" id="cb2-2" title="2"><span class="kw">library</span>(twinfoR)</a></code></pre></div>
</div>
<div id="some-important-initializations" class="section level1">
<h1>Some important initializations</h1>
<div id="initialize-database" class="section level2">
<h2>Initialize database</h2>
<p>We need to set a working directory to store the database and analysis products. Once we set the directory, we’ll change into it and initialize the politician database.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">dir.create</span>(<span class="st">&quot;~/USPol&quot;</span>,<span class="dt">showWarnings=</span><span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-2" title="2"><span class="kw">setwd</span>(<span class="st">&quot;~/USPol&quot;</span>)</a>
<a class="sourceLine" id="cb3-3" title="3">con &lt;-<span class="st"> </span><span class="kw">twitter_database</span>(</a>
<a class="sourceLine" id="cb3-4" title="4">  <span class="st">&quot;USPol.sqlite&quot;</span></a>
<a class="sourceLine" id="cb3-5" title="5">)</a></code></pre></div>
</div>
<div id="authenticate-to-twitter-api" class="section level2">
<h2>Authenticate to Twitter API</h2>
<p>We’ll use the <a href="http://zlisto.scripts.mit.edu/informs_tutorial/tutorial.html">INFORM-Tutorial</a> Twitter Application. Alternatively, you can supply your own application credentials using the <code>authorize_app</code> function.</p>
<p><em>You will need a Twitter Account to continue!</em> If you don’t have one, you can easily create one on the <a href="https://twitter.com">Twitter</a> website. If you do not have a Twitter account and do not wish to make one, <em>this package will be of very limited use to you</em>.</p>
<p>I recommend logging onto Twitter in your Browser before running this line. Either way, be careful not to hit <Enter> immediately after running it, for example by copying and pasting the whole line with the ‘newline’ character into an R console.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">auth.vector &lt;-<span class="st"> </span><span class="kw">authorize_IT</span>()</a></code></pre></div>
<p>Run this line, log into Twitter, and get the authentication PIN. If you get an error message from Twitter saying the URL is expired, the probable cause is that you hit <Enter> before entering the PIN, possibly when you copied and pasted the command.</p>
<p>It is important to name the result <code>auth.vector</code> as shown above, as the functions in the <code>twinfoR</code> package look for this global variable. If you give this result a different name, you must manually supply it to the Twitter API methods. Optionally, save this vector in order to skip the authentication process in the future.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1"><span class="kw">save</span>(auth.vector,<span class="dt">file=</span><span class="st">&quot;auth_vector.RData&quot;</span>)</a></code></pre></div>
</div>
</div>
<div id="creation-of-user-data.frame" class="section level1">
<h1>Creation of User data.frame</h1>
<p>In practice, construction of the list of Twitter Users for collection and analysis would normally occur without using the functions in this package. In this case, however, we are going to analyze the content produced by US Politicians. Fortunately, we do not have to spend time manually looking up the Twitter Accounts of the individual members of Congress; the US political parties keep these accounts in Twitter lists. These lists might not be up-to-date, but we are going to assume they are accurate enough for our purposes. These lists are</p>
<ul>
<li><a href="https://twitter.com/HouseDemocrats/lists/house-democrats">House Democrats</a> hosted by <span class="citation">@HouseDemocrats</span></li>
<li><a href="https://twitter.com/SenateDems/lists/senatedemocrats">Senate Democrats</a> hosted by <span class="citation">@SenateDems</span></li>
<li><a href="https://twitter.com/HouseGOP/lists/house-republicans">House Republicans</a> hosted by <span class="citation">@HouseGOP</span></li>
<li><a href="https://twitter.com/SenateGOP/lists/senaterepublicans">Senate Republicans</a> hosted by <span class="citation">@SenateGOP</span></li>
</ul>
<p>This is a good opportunity to show the workhorse function of the <code>twinfoR</code> package: <code>twitter_request</code>. While typical use of this package will not require direct calls to <code>twitter_request</code>, this function is called by all of the functions provided by this package that access the Twitter API.</p>
<p>We want to get the members of an existing Twitter list. This package does not provide a specific method for that purpose, but there is a <a href="https://developer.twitter.com/en/docs/accounts-and-users/create-manage-lists/api-reference/get-lists-members">Twitter API endpoint</a> that provides this service. Therefore, we use the general <code>twitter_request</code> function.</p>
<p>Note: to best understand the code below, you should read the documentation for the <code>twitter_request</code> function <em>and</em> the <code>get-lists-members</code> <a href="https://developer.twitter.com/en/docs/accounts-and-users/create-manage-lists/api-reference/get-lists-members">Twitter API endpoint</a> documentation. At then end we should have four lists of Twitter user objects: <code>house.dems</code>, <code>senate.dems</code>, <code>house.reps</code>, <code>senate.reps</code>, as well as the official user account of the US President (<span class="citation">@POTUS</span>).</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co"># Set the URL and count</span></a>
<a class="sourceLine" id="cb6-2" title="2">url &lt;-<span class="st"> &#39;https://api.twitter.com/1.1/lists/members.json&#39;</span></a>
<a class="sourceLine" id="cb6-3" title="3">count &lt;-<span class="st"> </span><span class="dv">5000</span></a>
<a class="sourceLine" id="cb6-4" title="4"></a>
<a class="sourceLine" id="cb6-5" title="5"></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co"># House Democrats</span></a>
<a class="sourceLine" id="cb6-7" title="7">slug &lt;-<span class="st"> &#39;house-democrats&#39;</span></a>
<a class="sourceLine" id="cb6-8" title="8">owner_screen_name &lt;-<span class="st"> &#39;HouseDemocrats&#39;</span></a>
<a class="sourceLine" id="cb6-9" title="9">response &lt;-<span class="st"> </span><span class="kw">twitter_request</span>(</a>
<a class="sourceLine" id="cb6-10" title="10">  auth.vector,</a>
<a class="sourceLine" id="cb6-11" title="11">  url,</a>
<a class="sourceLine" id="cb6-12" title="12">  <span class="dt">query.param.list =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb6-13" title="13">    <span class="dt">slug =</span> slug,</a>
<a class="sourceLine" id="cb6-14" title="14">    <span class="dt">owner_screen_name =</span> owner_screen_name,</a>
<a class="sourceLine" id="cb6-15" title="15">    <span class="dt">count=</span>count</a>
<a class="sourceLine" id="cb6-16" title="16">  )</a>
<a class="sourceLine" id="cb6-17" title="17">)</a>
<a class="sourceLine" id="cb6-18" title="18"><span class="co"># Check for 200 status</span></a>
<a class="sourceLine" id="cb6-19" title="19"><span class="cf">if</span>(response<span class="op">$</span>status<span class="op">==</span><span class="dv">200</span>){</a>
<a class="sourceLine" id="cb6-20" title="20">  house.dems.obj &lt;-<span class="st"> </span>httr<span class="op">::</span><span class="kw">content</span>(response)</a>
<a class="sourceLine" id="cb6-21" title="21">  house.dems &lt;-<span class="st"> </span>house.dems.obj<span class="op">$</span>users</a>
<a class="sourceLine" id="cb6-22" title="22">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb6-23" title="23">  <span class="kw">cat</span>(<span class="kw">paste</span>(<span class="st">&quot;API request failed; status &quot;</span>,response<span class="op">$</span>status,<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb6-24" title="24">}</a>
<a class="sourceLine" id="cb6-25" title="25"></a>
<a class="sourceLine" id="cb6-26" title="26"></a>
<a class="sourceLine" id="cb6-27" title="27"><span class="co"># Senate Democrats</span></a>
<a class="sourceLine" id="cb6-28" title="28">slug &lt;-<span class="st"> &#39;SenateDemocrats&#39;</span></a>
<a class="sourceLine" id="cb6-29" title="29">owner_screen_name &lt;-<span class="st"> &#39;SenateDems&#39;</span></a>
<a class="sourceLine" id="cb6-30" title="30">response &lt;-<span class="st"> </span><span class="kw">twitter_request</span>(</a>
<a class="sourceLine" id="cb6-31" title="31">  auth.vector,</a>
<a class="sourceLine" id="cb6-32" title="32">  url,</a>
<a class="sourceLine" id="cb6-33" title="33">  <span class="dt">query.param.list =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb6-34" title="34">    <span class="dt">slug =</span> slug,</a>
<a class="sourceLine" id="cb6-35" title="35">    <span class="dt">owner_screen_name =</span> owner_screen_name,</a>
<a class="sourceLine" id="cb6-36" title="36">    <span class="dt">count=</span>count</a>
<a class="sourceLine" id="cb6-37" title="37">  )</a>
<a class="sourceLine" id="cb6-38" title="38">)</a>
<a class="sourceLine" id="cb6-39" title="39"><span class="cf">if</span>(response<span class="op">$</span>status<span class="op">==</span><span class="dv">200</span>){</a>
<a class="sourceLine" id="cb6-40" title="40">  senate.dems.obj &lt;-<span class="st"> </span>httr<span class="op">::</span><span class="kw">content</span>(response)</a>
<a class="sourceLine" id="cb6-41" title="41">  senate.dems &lt;-<span class="st"> </span>senate.dems.obj<span class="op">$</span>users</a>
<a class="sourceLine" id="cb6-42" title="42">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb6-43" title="43">  <span class="kw">cat</span>(<span class="kw">paste</span>(<span class="st">&quot;API request failed; status &quot;</span>,response<span class="op">$</span>status,<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb6-44" title="44">}</a>
<a class="sourceLine" id="cb6-45" title="45"></a>
<a class="sourceLine" id="cb6-46" title="46"></a>
<a class="sourceLine" id="cb6-47" title="47"><span class="co"># House Republicans</span></a>
<a class="sourceLine" id="cb6-48" title="48">slug &lt;-<span class="st"> &#39;house-republicans&#39;</span></a>
<a class="sourceLine" id="cb6-49" title="49">owner_screen_name &lt;-<span class="st"> &#39;houseGOP&#39;</span></a>
<a class="sourceLine" id="cb6-50" title="50">response &lt;-<span class="st"> </span><span class="kw">twitter_request</span>(</a>
<a class="sourceLine" id="cb6-51" title="51">  auth.vector,</a>
<a class="sourceLine" id="cb6-52" title="52">  url,</a>
<a class="sourceLine" id="cb6-53" title="53">  <span class="dt">query.param.list =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb6-54" title="54">    <span class="dt">slug =</span> slug,</a>
<a class="sourceLine" id="cb6-55" title="55">    <span class="dt">owner_screen_name =</span> owner_screen_name,</a>
<a class="sourceLine" id="cb6-56" title="56">    <span class="dt">count=</span>count</a>
<a class="sourceLine" id="cb6-57" title="57">  )</a>
<a class="sourceLine" id="cb6-58" title="58">)</a>
<a class="sourceLine" id="cb6-59" title="59"><span class="cf">if</span>(response<span class="op">$</span>status<span class="op">==</span><span class="dv">200</span>){</a>
<a class="sourceLine" id="cb6-60" title="60">  house.reps.obj &lt;-<span class="st"> </span>httr<span class="op">::</span><span class="kw">content</span>(response)</a>
<a class="sourceLine" id="cb6-61" title="61">  house.reps &lt;-<span class="st"> </span>house.reps.obj<span class="op">$</span>users</a>
<a class="sourceLine" id="cb6-62" title="62">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb6-63" title="63">  <span class="kw">cat</span>(<span class="kw">paste</span>(<span class="st">&quot;API request failed; status &quot;</span>,response<span class="op">$</span>status,<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb6-64" title="64">}</a>
<a class="sourceLine" id="cb6-65" title="65"></a>
<a class="sourceLine" id="cb6-66" title="66"></a>
<a class="sourceLine" id="cb6-67" title="67"><span class="co"># Senate Republicans</span></a>
<a class="sourceLine" id="cb6-68" title="68">slug &lt;-<span class="st"> &#39;SenateRepublicans&#39;</span></a>
<a class="sourceLine" id="cb6-69" title="69">owner_screen_name &lt;-<span class="st"> &#39;SenateGOP&#39;</span></a>
<a class="sourceLine" id="cb6-70" title="70">response &lt;-<span class="st"> </span><span class="kw">twitter_request</span>(</a>
<a class="sourceLine" id="cb6-71" title="71">  auth.vector,</a>
<a class="sourceLine" id="cb6-72" title="72">  url,</a>
<a class="sourceLine" id="cb6-73" title="73">  <span class="dt">query.param.list =</span> <span class="kw">list</span>(</a>
<a class="sourceLine" id="cb6-74" title="74">    <span class="dt">slug =</span> slug,</a>
<a class="sourceLine" id="cb6-75" title="75">    <span class="dt">owner_screen_name =</span> owner_screen_name,</a>
<a class="sourceLine" id="cb6-76" title="76">    <span class="dt">count=</span>count</a>
<a class="sourceLine" id="cb6-77" title="77">  )</a>
<a class="sourceLine" id="cb6-78" title="78">)</a>
<a class="sourceLine" id="cb6-79" title="79"></a>
<a class="sourceLine" id="cb6-80" title="80"><span class="cf">if</span>(response<span class="op">$</span>status<span class="op">==</span><span class="dv">200</span>){</a>
<a class="sourceLine" id="cb6-81" title="81">  senate.reps.obj &lt;-<span class="st"> </span>httr<span class="op">::</span><span class="kw">content</span>(response)</a>
<a class="sourceLine" id="cb6-82" title="82">  senate.reps &lt;-<span class="st"> </span>senate.reps.obj<span class="op">$</span>users</a>
<a class="sourceLine" id="cb6-83" title="83">} <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb6-84" title="84">  <span class="kw">cat</span>(<span class="kw">paste</span>(<span class="st">&quot;API request failed; status &quot;</span>,response<span class="op">$</span>status,<span class="st">&quot;</span><span class="ch">\n</span><span class="st">&quot;</span>,<span class="dt">sep=</span><span class="st">&quot;&quot;</span>))</a>
<a class="sourceLine" id="cb6-85" title="85">}</a>
<a class="sourceLine" id="cb6-86" title="86"></a>
<a class="sourceLine" id="cb6-87" title="87"></a>
<a class="sourceLine" id="cb6-88" title="88"><span class="co"># President</span></a>
<a class="sourceLine" id="cb6-89" title="89">pres &lt;-<span class="st"> </span><span class="kw">user_show</span>(<span class="st">&#39;potus&#39;</span>)</a></code></pre></div>
<div id="sampling" class="section level2">
<h2>Sampling</h2>
<p>If you want this script to run in a short amount of time, take a small sample from the results. Sampling three from each set collected, and including the President (13 politicians in all) will keep the total collection time to about an hour.</p>
<p><strong>If you want to reduce collection time, sample using code similar to the following</strong></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="co"># Not run</span></a>
<a class="sourceLine" id="cb7-2" title="2">sample.size &lt;-<span class="st"> </span><span class="dv">3</span></a>
<a class="sourceLine" id="cb7-3" title="3">house.dems &lt;-<span class="st"> </span><span class="kw">sample</span>(house.dems,sample.size)</a>
<a class="sourceLine" id="cb7-4" title="4">senate.dems &lt;-<span class="st"> </span><span class="kw">sample</span>(senate.dems,sample.size)</a>
<a class="sourceLine" id="cb7-5" title="5">house.reps &lt;-<span class="st"> </span><span class="kw">sample</span>(house.reps,sample.size)</a>
<a class="sourceLine" id="cb7-6" title="6">senate.reps &lt;-<span class="st"> </span><span class="kw">sample</span>(senate.reps,sample.size)</a></code></pre></div>
<p>Now that we have the finalized lists of politicians we are going to collect, we can put them into a <code>query_user</code> data.frame structured as described in the <code>twitter_database</code> function documentation. Then, we add this table to the Twitter database connection (<code>con</code>).</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">house.reps.df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb8-2" title="2">  <span class="dt">user_id =</span> <span class="kw">sapply</span>(</a>
<a class="sourceLine" id="cb8-3" title="3">    house.reps,</a>
<a class="sourceLine" id="cb8-4" title="4">    <span class="cf">function</span>(x) <span class="kw">return</span> (x<span class="op">$</span>id_str)</a>
<a class="sourceLine" id="cb8-5" title="5">  ),</a>
<a class="sourceLine" id="cb8-6" title="6">  <span class="dt">screen_name =</span> <span class="kw">sapply</span>(</a>
<a class="sourceLine" id="cb8-7" title="7">    house.reps,</a>
<a class="sourceLine" id="cb8-8" title="8">    <span class="cf">function</span>(x) <span class="kw">return</span> (x<span class="op">$</span>screen_name)</a>
<a class="sourceLine" id="cb8-9" title="9">  ),</a>
<a class="sourceLine" id="cb8-10" title="10">  <span class="dt">party =</span> <span class="kw">rep</span>(<span class="st">&#39;republican&#39;</span>,<span class="kw">length</span>(house.reps)),</a>
<a class="sourceLine" id="cb8-11" title="11">  <span class="dt">body =</span> <span class="kw">rep</span>(<span class="st">&#39;house&#39;</span>,<span class="kw">length</span>(house.reps)),</a>
<a class="sourceLine" id="cb8-12" title="12">  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb8-13" title="13">)</a>
<a class="sourceLine" id="cb8-14" title="14">senate.reps.df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb8-15" title="15">  <span class="dt">user_id =</span> <span class="kw">sapply</span>(</a>
<a class="sourceLine" id="cb8-16" title="16">    senate.reps,</a>
<a class="sourceLine" id="cb8-17" title="17">    <span class="cf">function</span>(x) <span class="kw">return</span> (x<span class="op">$</span>id_str)</a>
<a class="sourceLine" id="cb8-18" title="18">  ),</a>
<a class="sourceLine" id="cb8-19" title="19">  <span class="dt">screen_name =</span> <span class="kw">sapply</span>(</a>
<a class="sourceLine" id="cb8-20" title="20">    senate.reps,</a>
<a class="sourceLine" id="cb8-21" title="21">    <span class="cf">function</span>(x) <span class="kw">return</span> (x<span class="op">$</span>screen_name)</a>
<a class="sourceLine" id="cb8-22" title="22">  ),</a>
<a class="sourceLine" id="cb8-23" title="23">  <span class="dt">party =</span> <span class="kw">rep</span>(<span class="st">&#39;republican&#39;</span>,<span class="kw">length</span>(senate.reps)),</a>
<a class="sourceLine" id="cb8-24" title="24">  <span class="dt">body =</span> <span class="kw">rep</span>(<span class="st">&#39;senate&#39;</span>,<span class="kw">length</span>(senate.reps)),</a>
<a class="sourceLine" id="cb8-25" title="25">  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb8-26" title="26">)</a>
<a class="sourceLine" id="cb8-27" title="27">house.dems.df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb8-28" title="28">  <span class="dt">user_id =</span> <span class="kw">sapply</span>(</a>
<a class="sourceLine" id="cb8-29" title="29">    house.dems,</a>
<a class="sourceLine" id="cb8-30" title="30">    <span class="cf">function</span>(x) <span class="kw">return</span> (x<span class="op">$</span>id_str)</a>
<a class="sourceLine" id="cb8-31" title="31">  ),</a>
<a class="sourceLine" id="cb8-32" title="32">  <span class="dt">screen_name =</span> <span class="kw">sapply</span>(</a>
<a class="sourceLine" id="cb8-33" title="33">    house.dems,</a>
<a class="sourceLine" id="cb8-34" title="34">    <span class="cf">function</span>(x) <span class="kw">return</span> (x<span class="op">$</span>screen_name)</a>
<a class="sourceLine" id="cb8-35" title="35">  ),</a>
<a class="sourceLine" id="cb8-36" title="36">  <span class="dt">party =</span> <span class="kw">rep</span>(<span class="st">&#39;democrat&#39;</span>,<span class="kw">length</span>(house.dems)),</a>
<a class="sourceLine" id="cb8-37" title="37">  <span class="dt">body =</span> <span class="kw">rep</span>(<span class="st">&#39;house&#39;</span>,<span class="kw">length</span>(house.dems)),</a>
<a class="sourceLine" id="cb8-38" title="38">  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb8-39" title="39">)</a>
<a class="sourceLine" id="cb8-40" title="40">senate.dems.df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb8-41" title="41">  <span class="dt">user_id =</span> <span class="kw">sapply</span>(</a>
<a class="sourceLine" id="cb8-42" title="42">    senate.dems,</a>
<a class="sourceLine" id="cb8-43" title="43">    <span class="cf">function</span>(x) <span class="kw">return</span> (x<span class="op">$</span>id_str)</a>
<a class="sourceLine" id="cb8-44" title="44">  ),</a>
<a class="sourceLine" id="cb8-45" title="45">  <span class="dt">screen_name =</span> <span class="kw">sapply</span>(</a>
<a class="sourceLine" id="cb8-46" title="46">    senate.dems,</a>
<a class="sourceLine" id="cb8-47" title="47">    <span class="cf">function</span>(x) <span class="kw">return</span> (x<span class="op">$</span>screen_name)</a>
<a class="sourceLine" id="cb8-48" title="48">  ),</a>
<a class="sourceLine" id="cb8-49" title="49">  <span class="dt">party =</span> <span class="kw">rep</span>(<span class="st">&#39;democrat&#39;</span>,<span class="kw">length</span>(senate.dems)),</a>
<a class="sourceLine" id="cb8-50" title="50">  <span class="dt">body =</span> <span class="kw">rep</span>(<span class="st">&#39;senate&#39;</span>,<span class="kw">length</span>(senate.dems)),</a>
<a class="sourceLine" id="cb8-51" title="51">  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb8-52" title="52">)</a>
<a class="sourceLine" id="cb8-53" title="53">pres.df &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</a>
<a class="sourceLine" id="cb8-54" title="54">  <span class="dt">user_id =</span> pres<span class="op">$</span>id_str,</a>
<a class="sourceLine" id="cb8-55" title="55">  <span class="dt">screen_name =</span> pres<span class="op">$</span>screen_name,</a>
<a class="sourceLine" id="cb8-56" title="56">  <span class="dt">party =</span> <span class="st">&#39;republican&#39;</span>, <span class="co"># For now!!!</span></a>
<a class="sourceLine" id="cb8-57" title="57">  <span class="dt">body =</span> <span class="st">&#39;whitehouse&#39;</span>,</a>
<a class="sourceLine" id="cb8-58" title="58">  <span class="dt">stringsAsFactors =</span> <span class="ot">FALSE</span></a>
<a class="sourceLine" id="cb8-59" title="59">)</a>
<a class="sourceLine" id="cb8-60" title="60"></a>
<a class="sourceLine" id="cb8-61" title="61">user.df &lt;-<span class="st"> </span><span class="kw">rbind</span>(</a>
<a class="sourceLine" id="cb8-62" title="62">  house.reps.df,</a>
<a class="sourceLine" id="cb8-63" title="63">  senate.reps.df,</a>
<a class="sourceLine" id="cb8-64" title="64">  house.dems.df,</a>
<a class="sourceLine" id="cb8-65" title="65">  senate.dems.df,</a>
<a class="sourceLine" id="cb8-66" title="66">  pres.df</a>
<a class="sourceLine" id="cb8-67" title="67">)</a>
<a class="sourceLine" id="cb8-68" title="68"></a>
<a class="sourceLine" id="cb8-69" title="69"><span class="co"># Upload this user data.frame to the Twitter Database</span></a>
<a class="sourceLine" id="cb8-70" title="70"></a>
<a class="sourceLine" id="cb8-71" title="71"><span class="kw">upload_query_users</span>(con,user.df)</a></code></pre></div>
<p>While we could upload the Twitter user objects we already collected, we’ll just use the <code>update_users</code> function to go through the <code>query_users</code> table in the database and collect each user profile from the Twitter API to insert into the <code>user</code> table of the database.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw">update_users</span>(con)</a></code></pre></div>
</div>
</div>
<div id="get-relationships" class="section level1">
<h1>Get Relationships</h1>
<p>Now that we have initialized a Twitter database with a list of US Politician Twitter accounts, we can collect their connections. Because politicians often have many followers, we are not going to bother collecting these. Rather, we are interested in whom the politicians are following, as each of these ‘friends’ represents a concious choice on the part of the politician.</p>
<p><strong>Note: this code takes a long time to execute.</strong> Expect a 15-20 hour run time on the full U.S. Congress. If you only kept a small sample, this time will be considerably shorter (typically 1.5-2 minutes per user). The prolonged collection times result from query limits imposed by Twitter on the REST API. The functions in this package include delays between queries to ensure these rate limits are not exceeded. However, attempts to run multiple collection functions in parallel processes using the same authentication credentials runs a high risk of violating the API rate limits, which <em>will</em> result in HTTP errors.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"><span class="co"># THIS TAKES A LONG TIME (15-20 hours) ON THE FULL SET.  You have been warned.</span></a>
<a class="sourceLine" id="cb10-2" title="2"><span class="kw">get_all_friends</span>(con)</a></code></pre></div>
</div>
<div id="get-statuses" class="section level1">
<h1>Get Statuses</h1>
<p>Next, we collect all of the posts from each politician, going back to up to 3200 Tweets. <strong>As in the previous step, this process can take a long time.</strong> During collection, we will perform sentiment analysis on the text of each Tweet (note: this is not done by default, so the parameters must be set as shown below). As a result of the sentiment analysis processing time and the Twitter API rate limits, expect this collection to take <strong>several days</strong> on the full data set. Once all of the statuses have been collected, future updates will take much less time as they will only collect new Twitter posts that have not yet been collected.</p>
<p>Setting up a sink to the NULL device prevents package <code>RSentiment</code> from outputing each status text to the screen. For large collections, this is recommended.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># THIS TAKES A LONG TIME (2-3 days) ON THE FULL SET.  You have been warned.</span></a>
<a class="sourceLine" id="cb11-2" title="2"></a>
<a class="sourceLine" id="cb11-3" title="3"><span class="co"># sink(&quot;/dev/null&quot;) # Recommended to suppress output, but might not work</span></a>
<a class="sourceLine" id="cb11-4" title="4"><span class="co">## on all platforms</span></a>
<a class="sourceLine" id="cb11-5" title="5"><span class="kw">update_user_timelines</span>(</a>
<a class="sourceLine" id="cb11-6" title="6">  con,</a>
<a class="sourceLine" id="cb11-7" title="7">  <span class="dt">calc.Rsentiment =</span> <span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb11-8" title="8">  <span class="dt">calc.syu =</span> <span class="ot">TRUE</span></a>
<a class="sourceLine" id="cb11-9" title="9">)</a>
<a class="sourceLine" id="cb11-10" title="10"><span class="co"># sink() # Close the sink to /dev/null</span></a></code></pre></div>
</div>
<div id="summarize-the-database" class="section level1">
<h1>Summarize the database</h1>
<p>To wrap up part I, we can view a summary of what is in our Twitter database. Note that many Tweets and users have been collected due to embedded retweets.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1"><span class="kw">summarize_database</span>(con)</a>
<a class="sourceLine" id="cb12-2" title="2"><span class="co">#&gt; Query users: 558</span></a>
<a class="sourceLine" id="cb12-3" title="3"><span class="co">#&gt; User categories:</span></a>
<a class="sourceLine" id="cb12-4" title="4"><span class="co">#&gt; party</span></a>
<a class="sourceLine" id="cb12-5" title="5"><span class="co">#&gt; body</span></a>
<a class="sourceLine" id="cb12-6" title="6"><span class="co">#&gt; since_id</span></a>
<a class="sourceLine" id="cb12-7" title="7"><span class="co">#&gt; friends_collected</span></a>
<a class="sourceLine" id="cb12-8" title="8"><span class="co">#&gt; followers_collected</span></a>
<a class="sourceLine" id="cb12-9" title="9"><span class="co">#&gt; No query text table.</span></a>
<a class="sourceLine" id="cb12-10" title="10"><span class="co">#&gt; Users: 579774</span></a>
<a class="sourceLine" id="cb12-11" title="11"><span class="co">#&gt; Statuses: 1599290</span></a>
<a class="sourceLine" id="cb12-12" title="12"><span class="co">#&gt; Unique user mentions: 123710</span></a>
<a class="sourceLine" id="cb12-13" title="13"><span class="co">#&gt; Unique hashtags: 81459</span></a>
<a class="sourceLine" id="cb12-14" title="14"><span class="co">#&gt; Unique URLs: 521248</span></a>
<a class="sourceLine" id="cb12-15" title="15"><span class="co">#&gt; Total Images: 532138</span></a>
<a class="sourceLine" id="cb12-16" title="16"><span class="co">#&gt; Unique Images: 497016</span></a>
<a class="sourceLine" id="cb12-17" title="17"><span class="co">#&gt; Total relationships: 1095918</span></a>
<a class="sourceLine" id="cb12-18" title="18"><span class="co">#&gt; Database file size: 1390MB</span></a></code></pre></div>
<p>Finally, to conclude this part of the vignette, we close the data connection.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">DBI<span class="op">::</span><span class="kw">dbDisconnect</span>(con)</a></code></pre></div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
